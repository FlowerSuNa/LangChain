# LangChain ê°œë…

- LLM ê¸°ë°˜ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œì„ ìœ„í•œ í”„ë ˆì„ì›Œí¬ì„
- LLM ì• í”Œë¦¬ì¼€ì´ì…˜ ë¼ì´í”„ì‚¬ì´í´ì˜ ëª¨ë“  ë‹¨ê³„ë¥¼ ë‹¤ë£¨ëŠ” ì˜¤í”ˆ ì†ŒìŠ¤ ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ ë„êµ¬ ëª¨ìŒì„ ì œê³µí•¨
- Chainê³¼ Agentë¼ëŠ” ë‘ ê°€ì§€ í•µì‹¬ ê¸°ëŠ¥ì„ í†µí•´ LLM ì• í”Œë¦¬ì¼€ì´ì…˜ì„ íš¨ìœ¨ì ìœ¼ë¡œ ê°œë°œí•˜ë„ë¡ ì§€ì›í•¨
    - Chain : ì‘ì—…ì„ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰í•˜ëŠ” íŒŒì´í”„ë¼ì¸ êµ¬ì¡° ì œê³µ
    - Agent : ììœ¨ì  ì˜ì‚¬ê²°ì •ì´ ê°€ëŠ¥í•œ ì‹¤í–‰ ë‹¨ìœ„
        - ìµœê·¼ì—ëŠ” ë³µì¡í•œ íë¦„ ì œì–´ë¥¼ ìœ„í•´ **LangGraph** ê¸°ë°˜ìœ¼ë¡œ í™•ì¥í•˜ì—¬ êµ¬í˜„í•˜ê¸°ë„ í•¨

<div style="text-align: center;">
    <img src="https://python.langchain.com/svg/langchain_stack_112024_dark.svg" 
        alt="langchain_stack" 
        width="600" 
        style="border: 0;">
</div>

---

## 1. ë“±ì¥ ë°°ê²½

- LLMì„ ì‚¬ìš©í•˜ì—¬ ìš”êµ¬ ì‚¬í•­ì— ë”°ë¼ ì‚¬ìš©ì ì§ˆì˜ë¥¼ í•´ì„í•  í•„ìš”ì„±ì´ ìƒê¹€
- ì´ì „ë¶€í„° ì—¬ëŸ¬ ì‹œìŠ¤í…œì´ë‚˜ ë°±ì—”ë“œ íˆ´ì„ ì´ìš©í•´ì•¼ í•˜ëŠ” ìš”êµ¬ ì‚¬í•­ì´ í”í•˜ê²Œ ìˆìŒ
    - ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë‘ ê°€ì§€ ì´ìƒì˜ DBê°€ í•„ìš”í•  ë•Œ ë§¤ë²ˆ DB ì ‘ì†ì„ ìœ„í•œ ì»¤ë„¥í„°ë¥¼ ìƒˆë¡œ ë§Œë“¤ë©´, ë¹„ìš©ì´ ë¹„ìŒˆ (ì „ë¬¸ ê°œë°œì í•„ìš”, ìœ ì§€/ë³´ìˆ˜/ê´€ë¦¬/ë°°í¬ ì˜¤ë²„í—¤ë“œ ë°œìƒ)
    - DBMSì— ì—‘ì„¸ìŠ¤ í•˜ê¸° ìœ„í•œ í‘œì¤€ API ë ˆì´ì–´ì¸ **ODBC**(Open Database Connectivity)ì™€ **JDBC**(Java Database Connectivity)ê°€ ë“±ì¥í•¨
    - ì´ëŸ° í‘œì¤€ API ë ˆì´ì–´ëŠ” DB ì‹œìŠ¤í…œê³¼ ìš´ì˜ì²´ì œê°€ ë…ë¦½ì ìœ¼ë¡œ ë™ì‘í•¨
    - ë”°ë¼ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë°ì´í„° ì•¡ì„¸ìŠ¤ ì½”ë“œë¥¼ ê±°ì˜ ë³€ê²½í•˜ì§€ ì•Šê³ ë„ í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ì˜ ë‹¤ë¥¸ í”Œë«í¼ìœ¼ë¡œ ì¸ì‹í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆìŒ
- LangChainì€ LLM ê¸°ë°˜ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œì„ ìœ„í•œ ê°œë°œì ì¹œí™”ì ì¸ ì˜¤í”ˆ ì†ŒìŠ¤ í”„ë ˆì„ì›Œí¬ì„
    - Pythonê³¼ JavaScript ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì œê³µí•¨
    - LLM ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ì¶•í•œ ë‹¤ìŒ í†µí•©í•  ìˆ˜ ìˆëŠ” ì¤‘ì•™ ì§‘ì¤‘ì‹ ê°œë°œ í™˜ê²½ì„ ê°–ì¶”ê³  ìˆìŒ

---

## 2. êµ¬ì„±ìš”ì†Œ (Components)

### 1\) ëª¨ë¸ (Models)

- í…ìŠ¤íŠ¸ ìƒì„± ì‘ì—…ì„ ì¤‘ì‹¬ìœ¼ë¡œ, ì¼ë°˜ í…ìŠ¤íŠ¸ ì…ë ¥(LLM) ë˜ëŠ” ë©”ì‹œì§€ ê¸°ë°˜ ì…ë ¥(Chat Model)ì„ ì²˜ë¦¬í•¨
- ë‹¤ì–‘í•œ LLM(OpenAI, HuggingFace, Cohere ë“±)ì„ ì¶”ìƒí™”í•˜ì—¬ ê³µí†µ ì¸í„°í˜ì´ìŠ¤ë¡œ ì œê³µí•¨
- ì‚¬ìš©ìëŠ” ê° ëª¨ë¸ì˜ ì„¸ë¶€ êµ¬í˜„ì„ ëª°ë¼ë„ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ í˜¸ì¶œ ê°€ëŠ¥í•¨
- ë³µì¡í•œ NLP ì‘ì—…ì„ ë‹¨ìˆœí•œ ì½”ë“œë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆì–´ ê°œë°œ ë¶€ë‹´ì´ ì¤„ì–´ë“¦
- API í‚¤ë§Œìœ¼ë¡œ ëŒ€ë¶€ë¶„ì˜ ì–¸ì–´ ëª¨ë¸ì„ ì‰½ê²Œ ì—°ë™í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ë˜ì–´ ìˆìŒ

### 2\) í”„ë¡¬í”„íŠ¸ (Prompts)

- í”„ë¡¬í”„íŠ¸ëŠ” ì‚¬ìš©ìê°€ LLMì— íƒœìŠ¤í¬ë¥¼ ìˆ˜í–‰í•˜ë¼ê³  ì „ë‹¬í•˜ëŠ” ëª…ë ¹ì–´ì„
- LLMì´ ì •í™•í•˜ê³  ìœ ìš©í•œ ì •ë³´ë¥¼ ì œê³µí•˜ë„ë¡ í”„ë¡¬í”„íŠ¸ë¥¼ ì •êµí•˜ê²Œ ì‘ì„±í•´ì•¼í•¨
    - ì›í•˜ëŠ” ì •ë³´ë‚˜ ê²°ê³¼ì˜ ìœ í˜•ì„ ëª…í™•í•˜ê²Œ ì •ì˜í•˜ì—¬ ì§ˆë¬¸í•´ì•¼ í•¨
    - í•µì‹¬ ì •ë³´ì— ì§‘ì¤‘í•˜ê³  ë¶ˆí•„ìš”í•œ ë‚´ìš©ì€ ì œê±°í•˜ì—¬ ì¤‘ìš”í•˜ì§€ ì•Šì€ ì •ë³´ì— LLMì´ ì£¼ì˜ë¥¼ ë¹¼ì•—ê¸°ì§€ ì•Šë„ë¡ í•´ì•¼ í•¨
    - ì—´ë¦° ì§ˆë¬¸ì„ ì‚¬ìš©í•˜ë©´ LLMì´ ë” í’ë¶€í•˜ê³  ë‹¤ì–‘í•œ ë‹µë³€ì„ ì œê³µí•¨
    - LLMì´ ë¬¸ë§¥ì„ ì´í•´í•  ìˆ˜ ìˆë„ë¡ í•„ìš”í•œ ë°°ê²½ ì •ë³´ë¥¼ ì œê³µí•˜ë©´, Hallucination ë°œìƒ ê°€ëŠ¥ì„±ì„ ì¤„ì´ê³  ê´€ë ¨ì„± ë†’ì€ ì‘ë‹µì„ ìœ ë„í•  ìˆ˜ ìˆìŒ
    - ëŒ€í™” íë¦„ê³¼ ìƒí™©ì— ë§ëŠ” ì–¸ì–´ì™€ í‘œí˜„ì„ ì„ íƒí•˜ì—¬ LLMì´ ë” ì ì ˆí•œ í†µê³¼ ë‚´ìš©ìœ¼ë¡œ ì‘ë‹µí•  ìˆ˜ ìˆë„ë¡ ìœ ë„í•´ì•¼ í•¨
- LangChainì—ëŠ” ëª…ë ¹ì„ ëª…í™•íˆ ì „ë‹¬í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” `PromptTemplate` í´ë˜ìŠ¤ê°€ ìˆìŒ
    - ì»¨í…ìŠ¤íŠ¸ì™€ ì§ˆì˜ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì¼ì¼ì´ ì‘ì„±í•  í•„ìš” ì—†ì´, í”„ë¡¬í”„íŠ¸ êµ¬ì„±ì„ êµ¬ì¡°í™”í•  ìˆ˜ ìˆìŒ
    - í…œí”Œë¦¿ ë‚´ë¶€ì— ì§€ì¹¨ì„ í¬í•¨í•˜ê±°ë‚˜, Few-Shot ì˜ˆì œë¥¼ í•¨ê»˜ ë„£ì–´ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
    - ë³€ìˆ˜ ì¹˜í™˜ì„ í†µí•´ ë™ì  í”„ë¡¬í”„íŠ¸ë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆì–´, ë‹¤ì–‘í•œ ì…ë ¥ì— ëŒ€í•´ ìœ ì—°í•˜ê²Œ ëŒ€ì‘ ê°€ëŠ¥í•¨

### 3\) ì²´ì¸ (Chains)

- ì²´ì¸ì€ LLMì„ ë‹¤ë¥¸ êµ¬ì„± ìš”ì†Œì™€ ê²°í•©í•˜ì—¬ ì¼ë ¨ì˜ íƒœìŠ¤í¬ë¥¼ ì‹¤í–‰í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìƒì„±í•¨
- ì²´ì¸ì˜ ê° íƒœìŠ¤í¬ëŠ” ì„œë¡œ ë‹¤ë¥¸ í”„ë¡¬í”„íŠ¸ë‚˜ LLMì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
- ex) ì‚¬ìš©ì ì…ë ¥ì„ ë¨¼ì € ìš”ì•½í•œ í›„, ìš”ì•½ëœ ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ ë‹µë³€ì„ ìƒì„±í•˜ê±°ë‚˜ ì™¸ë¶€ APIë¥¼ í˜¸ì¶œí•˜ëŠ” ë“± ë‹¨ê³„ì  ì²˜ë¦¬ ë¡œì§ì„ ì •ì˜í•  ìˆ˜ ìˆìŒ

### 4\) ì¸ë±ìŠ¤ (Indices)

- ìµœì ì˜ ë‹µë³€ì„ ìœ„í•´ì„œëŠ” LLM ë¿ë§Œ ì•„ë‹ˆë¼, ì¶œì²˜ê°€ í™•ì‹¤í•œ ê³ ê¸‰ ì „ë¬¸ ì •ë³´ì™€ ìµœì‹  ì •ë³´ê°€ ì¶”ê°€ë¡œ í•„ìš”í•¨ (ë¹„ìš© íš¨ìœ¨í™”ë¥¼ ìœ„í•´ RAGì™€ ê°™ì€ ê¸°ë²•ì„ ì‚¬ìš©í•¨)
- **Index**ëŠ” ì™¸ë¶€ ë¬¸ì„œë¥¼ LLMì´ íš¨ìœ¨ì ìœ¼ë¡œ ê²€ìƒ‰í•˜ê³  ì°¸ì¡°í•  ìˆ˜ ìˆë„ë¡ êµ¬ì„±í•œ êµ¬ì¡°ë¥¼ ì˜ë¯¸í•¨
- ì¼ë°˜ì ìœ¼ë¡œ Document Loader â†’ Text Splitter â†’ Embedding â†’ Vectorstore ê³¼ì •ì„ ê±°ì³ ì¸ë±ìŠ¤ë¥¼ êµ¬ì„±í•¨
- ëŒ€í‘œ êµ¬í˜„ì²´ë¡œëŠ” `VectorstoreIndexWrapper`, `RetrieverIndex`, `SelfQueryRetriever` ë“±ì´ ìˆìŒ

### 5\) ë©”ëª¨ë¦¬ (Memory)

- ì‚¬ìš©ìê°€ LLMê³¼ í”„ë¡¬í”„íŠ¸ ê¸°ë°˜ì„ ì‚¬ìš©í•˜ëŠ” ë™ì•ˆ ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ í¬í•¨í•˜ì—¬ ì£¼ìš” ì‚¬ì‹¤ì„ ê¸°ì–µí•˜ê³  ìƒí˜¸ ì‘ìš©ì— ëŒ€í•œ ì •ë³´ë¥¼ ì ìš©í•  ìˆ˜ ìˆìŒ
- ë©”ëª¨ë¦¬ë¥¼ í†µí•´ LLMì´ ì´ì „ ëŒ€í™” ë‚´ìš©ì„ ë°˜ì˜í•˜ì—¬ ë” ìì—°ìŠ¤ëŸ½ê³  ì¼ê´€ì„± ìˆëŠ” ì‘ë‹µì„ ìƒì„±í•  ìˆ˜ ìˆìŒ
- ëŒ€í™” ì „ì²´ë¥¼ ê¸°ì–µí•˜ëŠ” ì˜µì…˜ê³¼ ì§€ê¸ˆê¹Œì§€ì˜ ëŒ€í™” ìš”ì•½ë§Œ ê¸°ì–µí•˜ëŠ” ìš”ì•½ ì˜µì…˜ì´ ìˆìŒ
- ì²´ì¸ê³¼ ì—ì´ì „íŠ¸ëŠ” ë©”ëª¨ë¦¬ ê¸°ëŠ¥ì´ ì—†ë‹¤ë©´ ì…ë ¥ê°’ì„ ë…ë¦½ì ìœ¼ë¡œ ì²˜ë¦¬í•´ ì•ì„  ëŒ€í™”ë¥¼ ê³ ë ¤í•˜ì§€ ëª»í•¨

### 6\) ì—ì´ì „íŠ¸ (Agents)

- ì—ì´ì „íŠ¸ëŠ” íˆ´ ì‚¬ìš©, ì§ˆì˜ ê²°ì •, ë°˜ë³µ ì‹¤í–‰ ë“± ììœ¨ì ì¸ ì˜ì‚¬ê²°ì •ì´ ê°€ëŠ¥í•œ LLM ì‹¤í–‰ ë‹¨ìœ„ì„
- ì™¸ë¶€ API í˜¸ì¶œ, ê³„ì‚°ê¸°, ë°ì´í„°ë² ì´ìŠ¤ ì§ˆì˜ ë“±ì„ íˆ´ë¡œ êµ¬ì„±í•˜ì—¬ ë³µì¡í•œ ë¬¸ì œ í•´ê²° ì‹œ í™œìš©ë¨
- LangChainì—ì„œëŠ” `Tool`, `AgentExecutor`, `LLMChain` ë“±ì„ ì¡°í•©í•˜ì—¬ Agentë¥¼ êµ¬ì„±í•¨
- ë³µì¡í•œ ìƒíƒœ ê¸°ë°˜ íë¦„ ì œì–´ê°€ í•„ìš”í•œ ê²½ìš°, **LangGraph**ë¥¼ í™œìš©í•´ ì—ì´ì „íŠ¸ì˜ ì‹¤í–‰ íë¦„ì„ DAG í˜•íƒœë¡œ ì‹œê°í™” ë° ì œì–´í•  ìˆ˜ ìˆìŒ

---

## 3. ì„¤ì¹˜ ë° ì„¤ì •

- `langchain` í”„ë ˆì„ì›Œí¬ë¥¼ ì„¤ì¹˜í•˜ë©´ `langchain-core`, `langchain-community`, `langsmith` ë“± í”„ë¡œì íŠ¸ ìˆ˜í–‰ì— í•„ìˆ˜ì ì¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì´ í•¨ê»˜ ì„¤ì¹˜ë¨
    - `langchain-core` : ë‹¤ë¥¸ íŒ¨í‚¤ì§€ì— ìµœì†Œí•œìœ¼ë¡œ ì˜ì¡´í•˜ë©´ì„œ í•µì‹¬ ê¸°ëŠ¥ì„ ì œê³µí•¨
    - `langchain-community` : ì™¸ë¶€ ì„œë¹„ìŠ¤ ë° í”Œë«í¼ê³¼ì˜ í†µí•©ì„ ë‹´ë‹¹í•¨
    - `langchain-experimental` : ì•„ì§ ì•ˆì •í™”ë˜ì§€ ì•Šì€ ìƒˆë¡œìš´ ê¸°ëŠ¥ë“¤ì„ í¬í•¨í•¨ (ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œì—ëŠ” ê¶Œì¥í•˜ì§€ ì•ŠìŒ)
- ë‹¤ì–‘í•œ ì™¸ë¶€ ëª¨ë¸ ì œê³µìì™€ ë°ì´í„° ì €ì¥ì†Œ ë“±ê³¼ í†µí•©ì„ ìœ„í•´ì„œëŠ” ì˜ì¡´ì„± ì„¤ì¹˜ê°€ ë”°ë¡œ í•„ìš”í•¨
- ë§Œì•½ OpenAIì—ì„œ ì œê³µí•˜ëŠ” LLMì„ ì‚¬ìš©í•˜ë ¤ë©´ `langchain-openai`, `tiktoken` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•´ì•¼ í•¨
    - `langchain-openai` : GPT-3.5, GPT-4 ë“± LLM ëª¨ë¸ê³¼ ê¸°íƒ€ ë³´ì¡° ë„êµ¬ë¥¼ ì œê³µí•¨
    - `tiktoken` : OpenAI ëª¨ë¸ì´ ì‚¬ìš©í•˜ëŠ” Tokenizerë¥¼ ì œê³µí•¨
- ì¸ì¦ ì •ë³´(API Key ë“±)ëŠ” `.env` íŒŒì¼ì— ì €ì¥í•˜ê³ , ì‹¤í–‰ ì‹œ í™˜ê²½ ë³€ìˆ˜ë¡œ ë¡œë“œí•´ì„œ ì‚¬ìš©í•¨

```python
# í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ
from dotenv import load_dotenv
load_dotenv()
```

---

## 4. LangChain êµ¬ì„± ìš”ì†Œ ë§›ë³´ê¸°

**Model** : `langchain_openai` ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ `ChatOpenAI` í´ë˜ìŠ¤ë¥¼ í†µí•´ OpenAI ëª¨ë¸ì„ í˜¸ì¶œí•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ

```python
from langchain_openai import ChatOpenAI

model = ChatOpenAI(model="gpt-4.1-mini")

response = model.invoke("Gloryë¥¼ í•œêµ­ì–´ë¡œ ë²ˆì—­í•´ì£¼ì„¸ìš”.")
print("ë‹µë³€: ", response.content)
print("ë©”íƒ€ë°ì´í„°: ", response.response_metadata)
```

**Message** : ë©”ì‹œì§€ íƒ€ì…ì„ ë‚˜ëˆ„ì–´ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ ì—­í• ì„ ëª…í™•íˆ êµ¬ë¶„í•˜ê³ , ëŒ€í™” ë§¥ë½ì„ êµ¬ì¡°í™”í•˜ë©°, í”„ë¡¬í”„íŠ¸ë¥¼ ìœ ì—°í•˜ê²Œ ì„¤ê³„í•  ìˆ˜ ìˆìŒ

- `SystemMessage`: ëŒ€í™”ì˜ ì „ë°˜ì ì¸ ë§¥ë½ì´ë‚˜ ê·œì¹™ì„ ì„¤ì •í•˜ëŠ” ë©”ì‹œì§€ë¡œ, LLMì˜ ì‘ë‹µ ìŠ¤íƒ€ì¼, ì—­í• , ëª©ì  ë“±ì„ ì •ì˜í•  ë•Œ ì‚¬ìš©í•¨ (role: system)
- `HumanMessage`: ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë©”ì‹œì§€ë¥¼ ë‚˜íƒ€ëƒ„ (role: user)
- `AIMessage`: AI ëª¨ë¸ì´ ìƒì„±í•œ ì‘ë‹µ ë©”ì‹œì§€ë¥¼ ë‚˜íƒ€ë‚´ë©°, ì´ì „ ì‘ë‹µì„ ê¸°ë¡í•˜ê±°ë‚˜ í”„ë¡¬í”„íŠ¸ì— í¬í•¨ì‹œí‚¬ ë•Œ ì‚¬ìš©í•¨ (role: assistant)

```python
from langchain_core.messages import SystemMessage, HumanMessage

system_msg = SystemMessage(content="ë‹¹ì‹ ì€ ì˜ì–´ë¥¼ í•œêµ­ì–´ë¡œ ë²ˆì—­í•˜ëŠ” AI ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤.")
human_message = HumanMessage(content="Glory")

response = model.invoke([system_msg, human_message])
print("ë‹µë³€: ", response.content)
```

**Prompt** : í”„ë¡¬í”„íŠ¸ë¥¼ ì¼ê´€ëœ í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•˜ê³  ì¬ì‚¬ìš© ê°€ëŠ¥í•˜ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆìŒ

- `PromptTemplate` : ë‹¨ì¼ í…ìŠ¤íŠ¸ ì…ë ¥ì„ ë³€ìˆ˜ë¡œ êµ¬ì„±í•´ í¬ë§·íŒ…í•  ìˆ˜ ìˆëŠ” ê¸°ë³¸ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿
- `ChatPromptTemplate` : ì—¬ëŸ¬ ë©”ì‹œì§€(Human, AI, System ë“±)ë¥¼ í¬í•¨í•˜ëŠ” ëŒ€í™”í˜• í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿
- `MessagesPlaceholder` : ê¸°ì¡´ ë©”ì‹œì§€ ëª©ë¡ì„ í…œí”Œë¦¿ ë‚´ íŠ¹ì • ìœ„ì¹˜ì— ì‚½ì…í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” í´ë˜ìŠ¤

```python
from langchain_core.prompts import ChatPromptTemplate, MessagesPlaceholder

prompt = ChatPromptTemplate.from_messages([
    ("system", "ë‹¹ì‹ ì€ {subject}ì— ëŠ¥ìˆ™í•œ ë¹„ì„œì…ë‹ˆë‹¤"),
    MessagesPlaceholder(variable_name="history"),
    ("human", "{question}")
])
```

**Memory** : ëŒ€í™” ê¸°ë¡ì„ ì €ì¥ ë° ê´€ë¦¬í•˜ë©°, ì»¨í…ìŠ¤íŠ¸ ìœ ì§€ë¥¼ ìœ„í•´ ë‹¤ì–‘í•œ ë©”ëª¨ë¦¬ íƒ€ì…ì„ ì§€ì›í•¨ (ëŒ€í™” ìš”ì•½, ë²„í¼ ì €ì¥ ë“± í¬í•¨)

- `BaseChatMessageHistory` : ë©”ì‹œì§€ íˆìŠ¤í† ë¦¬ë¥¼ ì €ì¥í•˜ê³  ë¶ˆëŸ¬ì˜¤ëŠ” ê¸°ë³¸ í´ë˜ìŠ¤
- `RunnableWithMessageHistory` : ì²´ì¸ì´ë‚˜ ì—ì´ì „íŠ¸ ì‹¤í–‰ ì‹œ, ìë™ìœ¼ë¡œ ë©”ì‹œì§€ ê¸°ë¡ì„ ì—°ë™í•´ ì‚¬ìš©í•˜ëŠ” ë˜í¼ í´ë˜ìŠ¤
- `ConversationBufferMemory` : ìµœê·¼ ëŒ€í™” ë‚´ìš©ì„ ë²„í¼ í˜•íƒœë¡œ ìœ ì§€í•˜ì—¬ ê°„ë‹¨í•œ ë§¥ë½ì„ ì§€ì†ì ìœ¼ë¡œ ì œê³µí•˜ëŠ” í´ë˜ìŠ¤
- `SummaryMemory` : ì´ì „ ëŒ€í™” ë‚´ìš©ì„ ìš”ì•½í•´ ì €ì¥í•¨ìœ¼ë¡œì¨ ê¸´ ëŒ€í™” íˆìŠ¤í† ë¦¬ë„ ì••ì¶•ëœ í˜•íƒœë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” í´ë˜ìŠ¤

```python
from langchain_core.chat_history import BaseChatMessageHistory
from langchain_core.messages import BaseMessage
from pydantic import BaseModel, Field
from typing import List

# ë©”ëª¨ë¦¬ ê¸°ë°˜ íˆìŠ¤í† ë¦¬ êµ¬í˜„
class InMemoryHistory(BaseChatMessageHistory, BaseModel):
    messages: List[BaseMessage] = Field(default_factory=list)
    
    def add_messages(self, messages: List[BaseMessage]) -> None:
        self.messages.extend(messages)
    
    def clear(self) -> None:
        self.messages = []

# ì„¸ì…˜ ì €ì¥ì†Œ
store = {}

# ì„¸ì…˜ IDë¡œ íˆìŠ¤í† ë¦¬ ê°€ì ¸ì˜¤ê¸°
def get_session_history(session_id: str) -> BaseChatMessageHistory:
    if session_id not in store:
        store[session_id] = InMemoryHistory()
    return store[session_id]
```

**Chain** : ì—¬ëŸ¬ êµ¬ì„± ìš”ì†Œ(LLM, í”„ë¡¬í”„íŠ¸, íˆ´ ë“±)ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì—°ê²°í•˜ì—¬ ë³µì¡í•œ ì‘ì—… íë¦„ì„ êµ¬ì„±í•  ìˆ˜ ìˆìŒ

```python
from langchain_core.runnables.history import RunnableWithMessageHistory
from langchain_core.output_parsers import StrOutputParser

# ì²´ì¸ êµ¬ì„±
chain = prompt | model | StrOutputParser()

# íˆìŠ¤í† ë¦¬ ê´€ë¦¬ ì¶”ê°€
chain_with_history = RunnableWithMessageHistory(
    chain,
    get_session_history,
    input_messages_key="question",
    history_messages_key="history"
)

# ì²´ì¸ ì‹¤í–‰, íˆìŠ¤í† ë¦¬ ì´ìš©í•´ì„œ ëŒ€í™” ì§„í–‰
response = chain_with_history.invoke(
    {"subject": "ìˆ˜í•™", "question": "1+2ëŠ” ì–¼ë§ˆì¸ê°€ìš”?"},
    config={"configurable": {"session_id": "user1"}}
)
print("ë‹µë³€: ", response)
```

---

## Reference

- LangChain ê°œë… : ğŸ”— [Brunch](https://brunch.co.kr/@ywkim36/147) / [Wikidocs](https://wikidocs.net/231153)
- GPT APIë¥¼ í™œìš©í•œ ì¸ê³µì§€ëŠ¥ ì•± ê°œë°œ [2íŒ] | ì˜¬ë¦¬ë¹„ì— ì¼€ì¼ë¦°, ë§ˆë¦¬-ì•Œë¦¬ìŠ¤ ë¸”ë ˆíŠ¸ ì§€ìŒ | ì´ì¼ì„­, ë°•íƒœí™˜ ì˜®ê¹€